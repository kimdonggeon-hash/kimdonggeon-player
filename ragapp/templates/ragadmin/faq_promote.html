<!-- ragapp/templates/ragadmin/faq_promote.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title|default:"FAQ 승격" }}</title>
  <style>
    :root{
      --bg:#f7f8fb; --card:#ffffff; --text:#0f172a; --dim:#6b7280; --line:#e5e7eb;
      --accent:#2563eb; --accent-weak:#e8efff; --radius:14px;
      --danger:#ef4444; --ok:#10b981;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family:ui-sans-serif,system-ui,Segoe UI,Apple SD Gothic Neo,Malgun Gothic,Apple Color Emoji,Noto Color Emoji}
    .wrap{max-width:1000px;margin:40px auto;padding:0 20px}
    h1{margin:0 0 8px;font-size:28px;font-weight:800;letter-spacing:.2px}
    .desc{margin:0 0 18px;color:var(--dim)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
      box-shadow:0 8px 24px rgba(15,23,42,.05);padding:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label{color:var(--dim);font-size:14px}
    input[type="number"]{height:36px;padding:6px 10px;border:1px solid var(--line);border-radius:10px;min-width:80px}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;color:var(--text);
      padding:9px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{border-color:transparent;background:var(--accent);color:#fff}
    .btn.ghost{background:var(--accent-weak);border-color:transparent;color:var(--accent)}
    .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:10px}
    th,td{padding:12px 10px;border-bottom:1px solid var(--line);vertical-align:top}
    th{color:#111827;font-size:14px;text-align:left}
    tbody tr:hover{background:#fafbfd}
    .q{font-weight:600}
    .ans{color:#111827}
    .score{color:var(--dim);font-size:12px}
    .empty{color:var(--dim);text-align:center;padding:36px 8px}
    .section{margin-top:18px}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#f1f5f9;color:#475569;font-size:12px;border:1px solid var(--line)}
    .alert{border:1px solid #fecaca;background:#fff1f2;color:#991b1b;padding:12px;border-radius:12px}
    .footer-note{margin-top:14px;color:var(--dim);font-size:12px}
    @media (max-width:720px){
      .score{display:none}
      th:nth-child(4), td:nth-child(4){display:none}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>FAQ 승격</h1>
    <p class="desc">추천된 후보를 검토하고 FAQ 항목으로 승격하세요.</p>

    <!-- 상단 컨트롤 -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <form method="get" class="row" action="">
          <label>표시 개수&nbsp;
            <input type="number" name="limit" value="{{ limit|default:50 }}" min="1" max="500">
          </label>
          <button class="btn ghost" type="submit">새로고침</button>
        </form>

        <!-- 선택 승격 -->
        <form id="promoteForm" method="post" action="{% url 'ragadmin:faq_promote' %}" class="row">
          {% csrf_token %}
          <input type="hidden" name="action" value="promote-selected">
          <button id="promoteBtn" class="btn primary" type="submit" disabled>선택 승격</button>
        </form>
      </div>

      <!-- 후보 테이블 -->
      <table class="section">
        <thead>
          <tr>
            <th style="width:40px;">
              <input id="selAll" type="checkbox" aria-label="전체 선택">
            </th>
            <th>질문</th>
            <th>제안 답변(요약)</th>
            <th style="width:120px;">점수/출처</th>
          </tr>
        </thead>
        <tbody id="tbody">
        {% if candidates %}
          {% for c in candidates %}
          <tr>
            <td>
              <input class="sel" type="checkbox" name="ids" value="{{ c.id }}" form="promoteForm" />
            </td>
            <td class="q">
              {{ c.question|default:"(질문 없음)" }}
              {% if c.tags %}
                <div class="tag" style="margin-top:6px">{{ c.tags|join:", " }}</div>
              {% endif %}
            </td>
            <td class="ans">
              {{ c.answer|default:"" }}
            </td>
            <td class="score">
              {{ c.score|default:"-" }}
              {% if c.source %}<div>{{ c.source }}</div>{% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="4" class="empty">승격 후보가 없습니다.</td></tr>
        {% endif %}
        </tbody>
      </table>

      {% if error %}
        <div class="section alert"><strong>오류</strong><div>{{ error }}</div></div>
      {% endif %}

      {% if promoted %}
        <div class="section">
          <strong>최근 승격</strong>
          <ul style="margin:8px 0 0 18px;padding:0">
            {% for p in promoted %}
            <li style="margin:4px 0">
              <span class="tag">{{ p.created_at|default:"-" }}</span>
              &nbsp;{{ p.question|default:"(질문)" }}
            </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <p class="footer-note">
        선택 후 <b>선택 승격</b>을 누르면 FAQ 엔트리로 저장됩니다. (되돌리기는 모델 리스트에서 직접 처리)
      </p>
    </div>
  </div>

  <script>
    (function(){
      const selAll = document.getElementById('selAll');
      const promoteBtn = document.getElementById('promoteBtn');
      const updateState = () => {
        const boxes = Array.from(document.querySelectorAll('.sel'));
        const checked = boxes.filter(b => b.checked);
        promoteBtn.disabled = checked.length === 0;
        promoteBtn.textContent = checked.length ? `선택 승격 (${checked.length})` : '선택 승격';
        if (boxes.length) selAll.indeterminate = checked.length > 0 && checked.length < boxes.length;
        selAll.checked = boxes.length && checked.length === boxes.length;
      };
      if (selAll){
        selAll.addEventListener('change', () => {
          document.querySelectorAll('.sel').forEach(cb => cb.checked = selAll.checked);
          updateState();
        });
      }
      document.addEventListener('change', e => {
        if (e.target.classList && e.target.classList.contains('sel')) updateState();
      });
      updateState();
    })();
  </script>
</body>
</html>

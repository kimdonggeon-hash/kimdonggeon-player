{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>RAG Admin 가이드</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:#f3f4f6;
    color:#111827;
  }

  .wrap {max-width:980px;margin:24px auto;padding:12px 16px}
  h1 {font-size:26px;margin:4px 0 16px;font-weight:800;color:#111827}
  .lead {font-size:14px;color:#6b7280;margin-bottom:8px;}

  .card {
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:16px;
    padding:18px 20px;
    margin:12px 0;
    box-shadow:0 18px 40px rgba(15,23,42,0.04);
  }

  /* 기존 이동 버튼 스타일 재사용 */
  .gobtn{
    appearance:none;border:1px solid rgba(99,102,241,.45);
    background:linear-gradient(90deg,#6366f1 0%,#4f46e5 100%);
    color:#fff;font-weight:700;font-size:12px;padding:8px 12px;border-radius:10px;
    box-shadow:0 6px 16px rgba(0,0,0,.12);cursor:pointer;
  }
  .gobtn.alt { background:#0b1220;color:#9fb3ff;border-color:#2d3a8c }
  form.inline {display:inline-block;margin:6px 0}

  /* 가이드 레이아웃 */
  .guide-layout {
    display:flex;
    gap:16px;
    margin-top:12px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .guide-nav {
    flex:0 0 220px;
    border-radius:14px;
    background:#0b1120;
    color:#e5e7eb;
    padding:12px 10px;
  }

  .guide-nav-title {
    font-size:13px;
    font-weight:700;
    letter-spacing:0.02em;
    text-transform:uppercase;
    color:#9ca3af;
    margin-bottom:6px;
  }

  .guide-nav-btn {
    width:100%;
    display:flex;
    align-items:center;
    gap:6px;
    padding:7px 9px;
    margin:2px 0;
    border-radius:10px;
    border:none;
    background:transparent;
    color:#e5e7eb;
    font-size:13px;
    cursor:pointer;
    text-align:left;
  }
  .guide-nav-btn span.icon {width:18px;text-align:center;}
  .guide-nav-btn:hover {background:rgba(148,163,184,0.18);}
  .guide-nav-btn.is-active {
    background:linear-gradient(90deg,#6366f1 0%,#4f46e5 100%);
    box-shadow:0 10px 25px rgba(79,70,229,0.35);
  }

  .guide-detail {
    flex:1 1 0;
    min-width:0;
  }

  .guide-section {
    display:none;
    animation:fadeIn .18s ease-out;
  }
  .guide-section.is-active {display:block;}

  .guide-section h2 {
    font-size:18px;
    margin:0 0 6px;
  }
  .guide-summary {
    font-size:13px;
    color:#6b7280;
    margin-bottom:10px;
  }
  .guide-steps {
    font-size:13px;
    padding-left:18px;
    margin:6px 0 10px;
  }
  .guide-steps li {margin:3px 0;}
  .guide-tips {
    background:#f3f4ff;
    border-radius:10px;
    padding:8px 10px;
    margin:8px 0 10px;
    font-size:12px;
    color:#374151;
  }
  .guide-tips h3 {
    font-size:12px;
    margin:0 0 4px;
    font-weight:700;
  }
  .guide-tips ul {padding-left:16px;margin:0;}
  .guide-tips li {margin:2px 0;}
  .guide-actions {
    margin-top:6px;
  }
  .guide-actions .inline {margin-right:4px;}

  .guide-meta {
    font-size:11px;
    color:#9ca3af;
    margin-top:8px;
  }

  @keyframes fadeIn {
    from {opacity:0;transform:translateY(2px);}
    to {opacity:1;transform:translateY(0);}
  }

  @media (max-width:768px) {
    .guide-layout {flex-direction:column;}
    .guide-nav {flex:1 1 auto;}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>RAG Admin 가이드</h1>
  <p class="lead">각 관리 화면에서 무엇을 하는지, 어떤 순서로 쓰면 되는지 한눈에 볼 수 있는 설명서입니다.</p>

  <div class="card">
    <div class="guide-layout">
      <!-- 왼쪽: 기능 목록 -->
      <aside class="guide-nav">
        <div class="guide-nav-title">기능 목록</div>
        <button type="button" class="guide-nav-btn is-active" data-target="legal">
          <span class="icon">⚙️</span><span>법적설정</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="crawl-news">
          <span class="icon">📰</span><span>뉴스 인덱싱</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="upload-doc">
          <span class="icon">📄</span><span>문서 업로드</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="faq-suggest">
          <span class="icon">❓</span><span>FAQ 후보 관리</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="live-chat">
          <span class="icon">💬</span><span>Live Chat</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="ragsetting_list">
          <span class="icon">🧰</span><span>RAG 설정 목록</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="chatquerylog_list">
          <span class="icon">🗃</span><span>ChatQueryLog</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="feedback_list">
          <span class="icon">⭐</span><span>Feedback</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="ingesthistory_list">
          <span class="icon">📥</span><span>IngestHistory</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="ragchunk_list">
          <span class="icon">📚</span><span>RagChunk</span>
        </button>
        <button type="button" class="guide-nav-btn" data-target="mylog_list">
          <span class="icon">📝</span><span>MyLog</span>
        </button>
      </aside>

      <!-- 오른쪽: 선택한 기능 설명 -->
      <main class="guide-detail">
        <!-- 법적설정 -->
        <section id="section-legal" class="guide-section is-active">
          <h2>⚙️ 법적설정</h2>
          <p class="guide-summary">
            서비스 이름, 개인정보 처리방침 링크, 국외이전/테스터 안내 등 법적인 고지 문구를 한 곳에서 관리하는 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>서비스 이름, 운영자 연락처, 배포 도메인 등 기본 정보를 입력합니다.</li>
            <li>개인정보 처리방침·이용약관·국외이전·테스터 동의서 URL 또는 HTML을 채웁니다.</li>
            <li>IP 익명화, 로그 보관 기간 등 기본 정책 값을 확인합니다.</li>
            <li>저장 후, 사용자 화면(news.html 등)에서 실제 문구가 잘 노출되는지 확인합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>실제 배포 도메인을 미리 넣어두면, 추후 배포 시 링크를 다시 수정할 필요가 줄어듭니다.</li>
              <li>테스트 단계에서도 최소한의 개인정보 안내 문구는 채워두는 걸 권장합니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="legal">
              <button type="submit" class="gobtn alt">법적설정 화면 열기</button>
            </form>
          </div>
          <p class="guide-meta">* 개인정보/법무 쪽 담당자가 가장 먼저 확인해야 하는 화면입니다.</p>
        </section>

        <!-- 뉴스 인덱싱 -->
        <section id="section-crawl-news" class="guide-section">
          <h2>📰 뉴스 인덱싱</h2>
          <p class="guide-summary">
            외부 뉴스(RSS·네이버 등)를 가져와서 RAG 검색용 벡터 DB에 저장하는 기능입니다.
          </p>
          <ol class="guide-steps">
            <li>크롤링할 뉴스 소스(언론사, 카테고리, 키워드 등)를 설정합니다.</li>
            <li><strong>크롤링 실행</strong> 버튼을 눌러 최신 기사를 가져옵니다.</li>
            <li>가져온 기사 목록과 개수를 확인합니다.</li>
            <li><strong>인덱싱 실행</strong>을 눌러 벡터 DB에 저장합니다.</li>
            <li>사용자 QARAG에서 실제로 해당 기사들이 검색되는지 테스트합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>초기 테스트 시에는 기사 수를 20~50개 정도로 제한하면 속도와 비용을 확인하기 좋습니다.</li>
              <li>같은 기사를 여러 번 인덱싱하지 않도록, 중복 제거 옵션/정책을 같이 확인하세요.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="crawl-news">
              <button type="submit" class="gobtn">뉴스 인덱싱 화면 열기</button>
            </form>
          </div>
        </section>

        <!-- 문서 업로드 -->
        <section id="section-upload-doc" class="guide-section">
          <h2>📄 문서 업로드</h2>
          <p class="guide-summary">
            PDF·DOCX·텍스트 파일 등을 업로드해서 내부 문서도 RAG 검색에 포함시킬 수 있는 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>업로드할 파일(예: FAQ 문서, 매뉴얼, 내부 정책)을 선택합니다.</li>
            <li>문서의 카테고리/태그(예: <em>FAQ</em>, <em>내부정책</em>)를 지정합니다.</li>
            <li><strong>업로드</strong>를 눌러 파일을 저장합니다.</li>
            <li>업로드 후 바로 이어서 <strong>인덱싱 실행</strong> 버튼으로 벡터 DB에 반영합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>개인정보가 포함된 문서는 업로드 전에 비식별/마스킹 처리가 되어 있는지 꼭 확인하세요.</li>
              <li>파일명·태그를 잘 정리해두면 나중에 삭제/재인덱싱 할 때 찾기 쉽습니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="upload-doc">
              <button type="submit" class="gobtn">문서 업로드 화면 열기</button>
            </form>
          </div>
        </section>

        <!-- FAQ 후보 -->
        <section id="section-faq-suggest" class="guide-section">
          <h2>❓ FAQ 후보</h2>
          <p class="guide-summary">
            사용자 질문 로그에서 자주 나오거나, 따로 등록한 문장을 묶어서 FAQ 후보로 관리하는 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>최근 질문/답변 목록을 살펴보며 반복되는 패턴을 확인합니다.</li>
            <li>자주 나오는 질문은 <strong>FAQ 후보로 승격</strong> 또는 태그를 붙여 관리합니다.</li>
            <li>확정된 FAQ는 별도 문서나 프런트 FAQ 화면으로 옮길 수 있습니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>“동일 질문이 3번 이상” 같은 기준을 정해두면 운영자가 판단하기 쉽습니다.</li>
              <li>FAQ 후보가 많아지면, 카테고리(결제/계정/기술문의 등)로 나누는 것도 좋습니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="faq-suggest">
              <button type="submit" class="gobtn">FAQ 후보 화면 열기</button>
            </form>
          </div>
        </section>

        <!-- Live Chat -->
        <section id="section-live-chat" class="guide-section">
          <h2>💬 Live Chat</h2>
          <p class="guide-summary">
            QARAG에서 “상담사 연결”을 눌렀을 때 실제 상담사가 대기·응답하는 콘솔 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>상담 시간에는 이 화면을 켜놓고 <strong>대기 중 상태</strong>로 둡니다.</li>
            <li>새로운 세션이 들어오면, 해당 방을 선택해 메시지를 주고받습니다.</li>
            <li>상담이 끝나면 <strong>종료/정리 버튼</strong>을 눌러 세션 상태를 ‘종료’로 바꿉니다.</li>
            <li>퇴근 시에는 “오늘 세션 정리” 버튼이 있다면 한 번 눌러 정리합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>운영자 여러 명이 동시에 접속하는 경우, 누가 어떤 방을 담당하는지 간단히 규칙을 정해두면 좋습니다.</li>
              <li>상담 내용이 RAG 학습에 쓰일 수 있는지(법적 동의 여부)를 별도 정책으로 정리해두세요.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="live-chat">
              <button type="submit" class="gobtn alt">Live Chat 콘솔 열기</button>
            </form>
          </div>
        </section>

        <!-- RAG 설정 목록 -->
        <section id="section-ragsetting_list" class="guide-section">
          <h2>🧰 RAG 설정 목록</h2>
          <p class="guide-summary">
            임베딩 모델, 검색 전략, 온도 등 RAG 동작에 영향을 주는 핵심 설정값을 관리하는 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>현재 활성화된 설정(프로파일)을 확인합니다. (예: <em>prod</em> / <em>dev</em>)</li>
            <li>모델 이름, 토큰 제한, 검색 k값, 필터 조건 등을 조정합니다.</li>
            <li>변경 후에는 반드시 작은 질문으로 먼저 테스트해봅니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>설정 변경 전에 기존 값을 캡처해두면, 문제가 생겼을 때 쉽게 원복할 수 있습니다.</li>
              <li>테스트/운영 환경을 분리하고 싶다면 프로파일을 2개 이상 두는 것도 방법입니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="ragsetting_list">
              <button type="submit" class="gobtn">RAG 설정 목록 열기</button>
            </form>
          </div>
        </section>

        <!-- ChatQueryLog -->
        <section id="section-chatquerylog_list" class="guide-section">
          <h2>🗃 ChatQueryLog</h2>
          <p class="guide-summary">
            사용자가 QARAG에 보낸 질문과, 모델이 어떻게 답했는지 기록되는 로그입니다.
          </p>
          <ol class="guide-steps">
            <li>최근 일정 기간의 질문/응답을 조회합니다.</li>
            <li>오답·부적절한 답변이 있는지 확인하고, 사례를 모읍니다.</li>
            <li>필요하면 해당 질문을 문서/FAQ에 추가하거나, 필터링 룰을 보완합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>필터(기간/사용자/태그)를 잘 활용하면 문제 구간만 빠르게 볼 수 있습니다.</li>
              <li>개인정보가 포함된 질문이 있는지 정기적으로 점검하세요.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="chatquerylog_list">
              <button type="submit" class="gobtn">ChatQueryLog 열기</button>
            </form>
          </div>
        </section>

        <!-- Feedback -->
        <section id="section-feedback_list" class="guide-section">
          <h2>⭐ Feedback</h2>
          <p class="guide-summary">
            QARAG 답변에 대해 사용자가 남긴 “유용했어요/별로였어요” 평가와 코멘트를 모아두는 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>날짜별/점수별로 정렬해 어떤 답변이 문제였는지 살펴봅니다.</li>
            <li>특히 <strong>별로였어요</strong> 케이스를 중심으로 원인을 분석합니다.</li>
            <li>문제가 반복되는 경우, 관련 문서·RAG 설정·프롬프트를 수정합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>피드백이 적을 때는, 내부 테스트 팀에게 의도적으로 여러 케이스를 남겨달라고 요청해보세요.</li>
              <li>심각한 오답은 별도의 태그나 MyLog에 링크를 남겨 추적하는 것도 좋습니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="feedback_list">
              <button type="submit" class="gobtn">Feedback 로그 열기</button>
            </form>
          </div>
        </section>

        <!-- IngestHistory -->
        <section id="section-ingesthistory_list" class="guide-section">
          <h2>📥 IngestHistory</h2>
          <p class="guide-summary">
            어떤 데이터가 언제 인덱싱되었는지(뉴스/문서 등)를 기록하는 이력입니다.
          </p>
          <ol class="guide-steps">
            <li>최근 인덱싱 작업의 성공/실패 내역을 확인합니다.</li>
            <li>에러가 있는 경우, 로그 메시지를 보고 원인을 파악합니다.</li>
            <li>필요하면 같은 소스에 대해 재인덱싱을 수행합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>벡터 DB 용량/비용을 관리하려면, 오래된 인덱싱 이력을 기준으로 정리 정책을 세울 수 있습니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="ingesthistory_list">
              <button type="submit" class="gobtn">IngestHistory 열기</button>
            </form>
          </div>
        </section>

        <!-- RagChunk -->
        <section id="section-ragchunk_list" class="guide-section">
          <h2>📚 RagChunk</h2>
          <p class="guide-summary">
            실제로 검색에 쓰이는 “문단 단위 청크”들을 직접 살펴볼 수 있는 화면입니다.
          </p>
          <ol class="guide-steps">
            <li>특정 문서/뉴스/태그 기준으로 필터링해서 원하는 청크만 봅니다.</li>
            <li>텍스트가 잘게 쪼개져 있는지, 쓸데없는 부분은 없는지 확인합니다.</li>
            <li>청크가 너무 길거나 짧다면, 인덱싱 파이프라인의 분할 규칙을 조정합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>답변이 이상하게 나오는 문서가 있다면, 그 문서의 청크부터 직접 눈으로 확인해보세요.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="ragchunk_list">
              <button type="submit" class="gobtn">RagChunk 목록 열기</button>
            </form>
          </div>
        </section>

        <!-- MyLog -->
        <section id="section-mylog_list" class="guide-section">
          <h2>📝 MyLog</h2>
          <p class="guide-summary">
            운영자가 직접 남기는 메모·점검 사항·버그 기록 등을 관리하는 내부 로그입니다.
          </p>
          <ol class="guide-steps">
            <li>새로운 이슈나 아이디어가 있을 때 간단히 기록해 둡니다.</li>
            <li>우선순위, 담당자, 상태(진행중/완료)를 남기는 칼럼이 있다면 같이 채웁니다.</li>
            <li>정기적으로 MyLog를 보며 해야 할 일과 완료된 일을 정리합니다.</li>
          </ol>
          <div class="guide-tips">
            <h3>TIP</h3>
            <ul>
              <li>1일 1회 정도 MyLog를 훑어보는 루틴을 만들면, 프로젝트 상태를 잊지 않고 관리할 수 있습니다.</li>
            </ul>
          </div>
          <div class="guide-actions">
            <form class="inline" method="post" action="{% url 'ragadmin:goto' %}">
              {% csrf_token %}
              <input type="hidden" name="dest" value="mylog_list">
              <button type="submit" class="gobtn">MyLog 화면 열기</button>
            </form>
          </div>
        </section>
      </main>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const navButtons = document.querySelectorAll(".guide-nav-btn");
  const sections = document.querySelectorAll(".guide-section");

  function activate(target) {
    navButtons.forEach(btn => {
      btn.classList.toggle("is-active", btn.dataset.target === target);
    });
    sections.forEach(sec => {
      const secId = "section-" + target;
      sec.classList.toggle("is-active", sec.id === secId);
    });
  }

  navButtons.forEach(btn => {
    btn.addEventListener("click", function () {
      const target = this.dataset.target;
      activate(target);
    });
  });

  // 초기 활성화(HTML에 is-active 붙어 있더라도 한 번 정리)
  const first = document.querySelector(".guide-nav-btn.is-active") || navButtons[0];
  if (first) activate(first.dataset.target);
});
</script>
</body>
</html>

{% extends "ragapp/_base_feature.html" %}
{% load static %}
{% block title %}ê¸€ë¡œ ì´ë¯¸ì§€ ì°¾ê¸°{% endblock %}
{% block content %}

<style>
  /* ====== minimal, pretty, accessible ====== */
  .ms-wrap{max-width:1100px;margin:0 auto;display:grid;gap:16px}
  .ms-card{background:var(--card-bg, #0f172a);border:1px solid var(--line, rgba(148,163,184,.18));
           border-radius:16px;padding:18px}
  .ms-title{font-size:20px;margin:0 0 12px}
  .ms-muted{color:#94a3b8}
  .ms-err{padding:10px 12px;border-radius:10px;background:rgba(239,68,68,.08);
          border:1px solid rgba(239,68,68,.35);color:#fecaca}

  .ms-form{display:grid;gap:12px}
  .ms-row{display:grid;gap:10px;grid-template-columns:1fr;align-items:end}
  .ms-input,.ms-num{
    width:100%;padding:11px 12px;border-radius:12px;border:1px solid var(--line, rgba(148,163,184,.18));
    background:var(--card-sub,#0b1326);color:var(--ink,#e5e7eb);outline:none
  }
  .ms-input:focus,.ms-num:focus{border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.25)}

  .ms-btnbar{display:flex;gap:8px;flex-wrap:wrap}
  .ms-btn{
    padding:10px 14px;border-radius:10px;border:1px solid var(--line, rgba(148,163,184,.18));
    background:#111b34;color:#e5e7eb;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;cursor:pointer
  }
  .ms-btn.primary{background:linear-gradient(90deg,#6366f1,#4f46e5);border-color:transparent}
  .ms-btn.ghost{background:#0b1326}

  .ms-topline{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
  .ms-chip{font-size:12px;color:#94a3b8;border:1px solid var(--line, rgba(148,163,184,.18));
           padding:4px 8px;border-radius:999px}

  .ms-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill, minmax(180px,1fr))}
  .ms-item{border:1px solid var(--line, rgba(148,163,184,.18));border-radius:14px;overflow:hidden;background:#0b1326}
  .ms-thumb{width:100%;aspect-ratio:4/3;object-fit:cover;display:block;background:#0b152a}
  .ms-meta{padding:10px}
  .ms-cap{font-size:14px;line-height:1.4}
  .ms-dim{font-size:12px;color:#94a3b8;margin-top:4px;word-break:break-all}

  .ms-pager{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px}
  .ms-pill{padding:6px 10px;border-radius:999px;border:1px solid var(--line, rgba(148,163,184,.18))}
  .ms-pill.disabled{opacity:.5;pointer-events:none}

  @media (min-width:720px){
    .ms-row{grid-template-columns:1fr 120px 120px 140px}
  }

  /* ====== ì‚¬ìš© ì„¤ëª…ì„œ ì¹´ë“œ ====== */
  .ms-help-card{
    background:
      radial-gradient(circle at top left, rgba(56,189,248,.10), transparent 55%),
      radial-gradient(circle at bottom right, rgba(129,140,248,.18), transparent 55%),
      #020617;
    border-radius:18px;
    border:1px solid rgba(148,163,184,.45);
    padding:18px 20px;
    box-shadow:0 18px 45px rgba(15,23,42,.75);
    color:#e5e7eb;
  }
  .ms-help-header{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
  .ms-help-title{display:flex;align-items:center;gap:8px}
  .ms-help-title h2{margin:0;font-size:15px;font-weight:700;letter-spacing:.02em;color:#f9fafb}
  .ms-help-pill{
    display:inline-flex;align-items:center;justify-content:center;
    padding:2px 8px;border-radius:999px;
    font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.14em;
    background:linear-gradient(90deg,#38bdf8,#6366f1);
    color:#020617;
  }
  .ms-help-sub{margin:0;font-size:12px;color:#9ca3af}

  .ms-help-body{
    display:grid;
    grid-template-columns:minmax(0,2.1fr) minmax(0,1.3fr);
    gap:18px;
    margin-top:6px;
  }
  @media (max-width:900px){
    .ms-help-body{grid-template-columns:minmax(0,1fr)}
  }

  .ms-help-steps{
    margin:0;
    padding-left:18px;
    display:flex;
    flex-direction:column;
    gap:8px;
    font-size:13px;
    color:#d1d5db;
  }
  .ms-help-steps li strong{color:#e5e7eb}
  .ms-help-steps li em{font-style:normal;color:#a5b4fc}

  .ms-help-notes{
    padding:12px 13px 10px;
    border-radius:14px;
    background:rgba(15,23,42,.96);
    border:1px dashed rgba(148,163,184,.7);
  }
  .ms-help-notes h3{
    margin:0 0 6px;
    font-size:13px;font-weight:600;color:#e5e7eb;
  }
  .ms-help-notes ul{
    margin:0;
    padding-left:16px;
    display:flex;
    flex-direction:column;
    gap:4px;
    font-size:12px;
    color:#9ca3af;
  }
</style>

<div class="ms-wrap">
  <!-- ê²€ìƒ‰ íŒ¨ë„ -->
  <section class="ms-card" aria-labelledby="search-title">
    <h1 id="search-title" class="ms-title">ê¸€ë¡œ ì´ë¯¸ì§€ ì°¾ê¸°</h1>
    {% if error %}<div class="ms-err" role="alert">âŒ {{ error }}</div>{% endif %}

    <form class="ms-form" method="get" action="{% url 'media_search' %}">
      <div class="ms-row">
        <div>
          <label class="ms-muted" for="q">ì°¾ê³  ì‹¶ì€ ë‚´ìš©</label>
          <input id="q" class="ms-input" type="text" name="q"
                 value="{{ q|default:'' }}" placeholder="ì˜ˆ: ë…¸ì„ ì§„ ë°”ë‹¤ í’ê²½, ì¹´í˜ì—ì„œ ê³µë¶€í•˜ëŠ” ì‚¬ëŒ" required />
        </div>
        <div>
          <label class="ms-muted" for="size">í•œ ë²ˆì— ë³¼ ê°œìˆ˜</label>
          <input id="size" class="ms-num" type="number" name="size" min="1" max="48" value="{{ size|default:12 }}"/>
        </div>
        <div>
          <label class="ms-muted" for="page">í˜ì´ì§€ ë²ˆí˜¸</label>
          <input id="page" class="ms-num" type="number" name="page" min="1" value="{{ page|default:1 }}"/>
        </div>
        <div>
          <label class="ms-muted" for="k">ê²€ìƒ‰ ë²”ìœ„(ê³ ê¸‰ ì„¤ì •)</label>
          <input id="k" class="ms-num" type="number" name="k" min="1" max="600" value="{{ k|default:120 }}"/>
        </div>
      </div>
      <div class="ms-btnbar">
        <button class="ms-btn primary" type="submit" aria-label="ê²€ìƒ‰ ì‹¤í–‰">ğŸ” ê²€ìƒ‰í•˜ê¸°</button>
        <a class="ms-btn ghost" href="{% url 'media_index' %}">â† ì´ë¯¸ì§€ ëª¨ì•„ë‘ê¸°</a>
        {% if q %}
          <a class="ms-btn" href="{% url 'media_search' %}">ì…ë ¥ ì§€ìš°ê³  ìƒˆë¡œ ê²€ìƒ‰</a>
        {% endif %}
      </div>
    </form>
  </section>

  <!-- âœ… ì‚¬ìš© ì„¤ëª…ì„œ ì¹´ë“œ (ì¼ë°˜ì¸ìš© ì„¤ëª…) -->
  <section class="ms-help-card" aria-label="ê¸€ë¡œ ì´ë¯¸ì§€ ì°¾ê¸° ì‚¬ìš© ì•ˆë‚´">
    <div class="ms-help-header">
      <div class="ms-help-title">
        <span class="ms-help-pill">Guide</span>
        <h2>ì°¾ê³  ì‹¶ì€ ê·¸ë¦¼ì„ ê¸€ë¡œ ë§í•´ ì£¼ì„¸ìš”</h2>
      </div>
      <p class="ms-help-sub">
        ì´ í™”ë©´ì€ <b>ë¬¸ì¥ì´ë‚˜ í‚¤ì›Œë“œë¡œ ì‚¬ì§„ì„ ì°¾ëŠ” ê²€ìƒ‰ì°½</b>ì´ì—ìš”.  
        â€œì–´ë–¤ ì¥ë©´ì¸ì§€â€ë¥¼ ê¸€ë¡œ ì ìœ¼ë©´, ê·¸ì™€ ë¹„ìŠ·í•œ ëŠë‚Œì˜ ì‚¬ì§„ë“¤ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
      </p>
    </div>

    <div class="ms-help-body">
      <ol class="ms-help-steps">
        <li>
          <strong>ë³´ê³  ì‹¶ì€ ì¥ë©´ì„ ë¬¸ì¥ìœ¼ë¡œ ì“°ê¸°</strong><br />
          ì˜ˆë¥¼ ë“¤ì–´ <em>â€œë…¸ì„ ì§„ ë°”ë‹¤ë¥¼ ë©€ë¦¬ì„œ ë°”ë¼ë³¸ ì‚¬ì§„â€</em>,  
          <em>â€œì¹´í˜ì—ì„œ ë…¸íŠ¸ë¶ìœ¼ë¡œ ì¼ì„ í•˜ëŠ” ì‚¬ëŒâ€</em>ì²˜ëŸ¼  
          ë¨¸ë¦¿ì†ì— ë– ì˜¤ë¥´ëŠ” ì¥ë©´ì„ ìì—°ìŠ¤ëŸ½ê²Œ ê¸€ë¡œ ì ì–´ ì£¼ì„¸ìš”.
        </li>
        <li>
          <strong>í•œ ë²ˆì— ë³¼ ê°œìˆ˜ Â· í˜ì´ì§€ ë²ˆí˜¸</strong><br />
          í•œ í™”ë©´ì—ì„œ ë³´ê³  ì‹¶ì€ ì‚¬ì§„ ê°œìˆ˜ëŠ” <em>â€œí•œ ë²ˆì— ë³¼ ê°œìˆ˜â€</em>ì—ì„œ ì •í•  ìˆ˜ ìˆì–´ìš”.  
          ë” ë§ì€ ê²°ê³¼ë¥¼ ë³´ê³  ì‹¶ìœ¼ë©´ <em>â€œí˜ì´ì§€ ë²ˆí˜¸â€</em>ë¥¼ 2, 3ì²˜ëŸ¼ ë°”ê¿”ê°€ë©° ë„˜ê²¨ë³´ë©´ ë©ë‹ˆë‹¤.
        </li>
        <li>
          <strong>ê²€ìƒ‰ ë²”ìœ„(ê³ ê¸‰ ì„¤ì •) ì´í•´í•˜ê¸°</strong><br />
          ì•„ë˜ <em>â€œê²€ìƒ‰ ë²”ìœ„(ê³ ê¸‰ ì„¤ì •)â€</em> ìˆ«ìëŠ”  
          ì•ˆì—ì„œ ë¯¸ë¦¬ ì‚´í´ë³´ëŠ” ì‚¬ì§„ ê°œìˆ˜ë¥¼ ì •í•˜ëŠ” ì˜µì…˜ì´ì—ìš”.  
          ìˆ«ìê°€ í´ìˆ˜ë¡ ë” ë§ì€ í›„ë³´ë¥¼ í™•ì¸í•˜ì§€ë§Œ, ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ” ì†ë„ê°€ ì¡°ê¸ˆ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
          ì˜ ëª¨ë¥´ì‹œê² ë‹¤ë©´ <b>ê·¸ëŒ€ë¡œ ë‘ì…”ë„ ì¶©ë¶„í•´ìš”.</b>
        </li>
        <li>
          <strong>ê²€ìƒ‰ ì‹¤í–‰ & ì‚¬ì§„ ë” ì˜¬ë¦¬ê¸°</strong><br />
          <em>â€œê²€ìƒ‰í•˜ê¸°â€</em> ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.  
          ì›í•˜ëŠ” ì‚¬ì§„ì´ ë³´ì´ì§€ ì•Šìœ¼ë©´ <em>â€œì´ë¯¸ì§€ ëª¨ì•„ë‘ê¸°â€</em> í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€  
          ìƒˆ ì‚¬ì§„ì„ ì˜¬ë¦° ë’¤, ë‹¤ì‹œ ê²€ìƒ‰í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </li>
      </ol>

      <div class="ms-help-notes">
        <h3>ì£¼ì˜ & ì‘ì€ íŒ</h3>
        <ul>
          <li>ê²€ìƒ‰ì´ ì˜ ì•ˆ ë  ë•ŒëŠ” ë¬¸ì¥ì„ ì¡°ê¸ˆ ë” ê¸¸ê²Œ ì“°ê±°ë‚˜, í•µì‹¬ ë‹¨ì–´ë§Œ ë‚¨ê¸°ê³  ë‹¤ì‹œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.</li>
          <li>ë°©ê¸ˆ ì˜¬ë¦° ì‚¬ì§„ì€ ì‚¬ì§„ ì €ì¥ ì‘ì—…ì´ ëë‚œ ë’¤ì—ì•¼ ê²€ìƒ‰ ê²°ê³¼ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</li>
          <li>ê²°ê³¼ ì¹´ë“œì— ë³´ì´ëŠ” <b>â€œì €ì¥ ìœ„ì¹˜â€</b>ì™€ <b>â€œì‚¬ì§„ ë²ˆí˜¸â€</b>ëŠ”  
              ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ìš´ì˜ìë‚˜ ê°œë°œìì—ê²Œ ì•Œë ¤ì¤„ ìˆ˜ ìˆëŠ” ì°¸ê³  ì •ë³´ì˜ˆìš”.</li>
        </ul>
      </div>
    </div>
  </section>

  {% if page_obj or hits %}
  <!-- ê²°ê³¼ íŒ¨ë„ -->
  <section class="ms-card" aria-labelledby="result-title">
    <div class="ms-topline">
      <h2 id="result-title" class="ms-title" style="margin:0">ê²€ìƒ‰ ê²°ê³¼</h2>
      {% if page_obj %}
        <div class="ms-muted">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }} í˜ì´ì§€</div>
      {% endif %}
    </div>

    {% if page_obj %}
      <div style="margin-bottom:8px">
        <span class="ms-chip">ì´ {{ page_obj.paginator.count }}ê°œ</span>
        {% if q %}<span class="ms-chip">â€œ{{ q }}â€</span>{% endif %}
      </div>

      <div class="ms-grid">
        {% for h in page_obj.object_list %}
          <div class="ms-item">
            {% if h.thumbnail or h.url %}
              <img class="ms-thumb"
                   src="{{ h.thumbnail|default:h.url }}"
                   alt="{{ h.caption|default:'ì‚¬ì§„' }}"
                   loading="lazy"
                   onerror="this.onerror=null; this.src='{% static 'ragapp/img/placeholder.png' %}'">
            {% else %}
              <img class="ms-thumb" src="{% static 'ragapp/img/placeholder.png' %}" alt="ì‚¬ì§„ ì—†ìŒ" loading="lazy">
            {% endif %}
            <div class="ms-meta">
              <div class="ms-cap">{{ h.caption|default:"(ì„¤ëª… ì—†ìŒ)" }}</div>
              <div class="ms-dim">ì €ì¥ ìœ„ì¹˜: {{ h.path }}</div>
              <div class="ms-dim">ì‚¬ì§„ ë²ˆí˜¸: {{ h.pid }}</div>
            </div>
          </div>
        {% empty %}
          <div class="ms-muted">ì¡°ê±´ì— ë§ëŠ” ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        {% endfor %}
      </div>

      <nav class="ms-pager" aria-label="í˜ì´ì§€ ì´ë™">
        {% if page_obj.has_previous %}
          <a class="ms-pill" href="?q={{ q|urlencode }}&size={{ size }}&k={{ k }}&page={{ page_obj.previous_page_number }}">â† ì• í˜ì´ì§€</a>
        {% else %}
          <span class="ms-pill disabled">â† ì• í˜ì´ì§€</span>
        {% endif %}
        <span class="ms-muted">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a class="ms-pill" href="?q={{ q|urlencode }}&size={{ size }}&k={{ k }}&page={{ page_obj.next_page_number }}">ë‹¤ìŒ í˜ì´ì§€ â†’</a>
        {% else %}
          <span class="ms-pill disabled">ë‹¤ìŒ í˜ì´ì§€ â†’</span>
        {% endif %}
      </nav>

    {% else %}
      <div style="margin-bottom:8px">
        {% if q %}<span class="ms-chip">â€œ{{ q }}â€</span>{% endif %}
        <span class="ms-chip">ì´ {{ hits|length }}ê°œ</span>
      </div>

      <div class="ms-grid">
        {% for h in hits %}
          <div class="ms-item">
            {% if h.thumbnail or h.url %}
              <img class="ms-thumb"
                   src="{{ h.thumbnail|default:h.url }}"
                   alt="{{ h.caption|default:'ì‚¬ì§„' }}"
                   loading="lazy"
                   onerror="this.onerror=null; this.src='{% static 'ragapp/img/placeholder.png' %}'">
            {% else %}
              <img class="ms-thumb" src="{% static 'ragapp/img/placeholder.png' %}" alt="ì‚¬ì§„ ì—†ìŒ" loading="lazy">
            {% endif %}
            <div class="ms-meta">
              <div class="ms-cap">{{ h.caption|default:"(ì„¤ëª… ì—†ìŒ)" }}</div>
              <div class="ms-dim">ì €ì¥ ìœ„ì¹˜: {{ h.path }}</div>
              <div class="ms-dim">ì‚¬ì§„ ë²ˆí˜¸: {{ h.pid }}</div>
            </div>
          </div>
        {% empty %}
          <div class="ms-muted">ì¡°ê±´ì— ë§ëŠ” ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        {% endfor %}
      </div>

      <nav class="ms-pager" aria-label="í˜ì´ì§€ ì´ë™">
        {% if has_prev %}
          <a class="ms-pill" href="?q={{ q|urlencode }}&size={{ size }}&k={{ k }}&page={{ page|add:-1 }}">â† ì• í˜ì´ì§€</a>
        {% else %}
          <span class="ms-pill disabled">â† ì• í˜ì´ì§€</span>
        {% endif %}
        <span class="ms-muted">page {{ page }}</span>
        {% if has_next %}
          <a class="ms-pill" href="?q={{ q|urlencode }}&size={{ size }}&k={{ k }}&page={{ page|add:1 }}">ë‹¤ìŒ í˜ì´ì§€ â†’</a>
        {% else %}
          <span class="ms-pill disabled">ë‹¤ìŒ í˜ì´ì§€ â†’</span>
        {% endif %}
      </nav>
    {% endif %}
  </section>

  {% elif q and not error %}
  <section class="ms-card">
    <div class="ms-muted">
      ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸€ì„ ì¡°ê¸ˆ ë°”ê¾¸ê±°ë‚˜, ìˆ«ì ì„¤ì •ì„ ì¤„ì—¬ì„œ ë‹¤ì‹œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.
    </div>
  </section>
  {% endif %}
</div>
{% endblock %}
